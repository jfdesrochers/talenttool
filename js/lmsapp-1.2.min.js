Function.prototype.papp=function(){var c=Array.prototype.slice;var b=this;var a=c.call(arguments);return function(){b.apply(this,a.concat(c.call(arguments)))}};var nonJsonErrors=function(a){return a.status>200?JSON.stringify(a.responseText):a.responseText};String.prototype.hashCode=function(){var b,a,c=2166136261;for(b=0,a=this.length;b<a;b++){c^=this.charCodeAt(b);c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24)}return("0000000"+(c>>>0).toString(16)).substr(-8)};var errorAlert=function(a){return m("div",{className:"alert alert-danger"},[m("strong",l.errors.errorLabel()),a])};var topBanner=function(a){a=a||false;return m("div.row"+(a?".text-center":""),m("div.col-sm-12",[m("img"+(a?".jfdlogo":".jfdlogotop"),{src:"img/logojfdtr.png"}),m("h2.apptitle",l.main.talentTitle()),m("p",[l.main.talentDesc(),m("a[href='/help']",{config:m.route},l.main.talentLinkTitle())])]))};var languageWidget=function(){return m("div",{className:"btn-group top-right"},[m("button",{className:"btn btn-xs "+(l.currentLanguage()=="fr"?"btn-primary":"btn-default"),onclick:l.currentLanguage.papp("fr")},"FR"),m("button",{className:"btn btn-xs "+(l.currentLanguage()=="en"?"btn-primary":"btn-default"),onclick:l.currentLanguage.papp("en")},"EN")])};var Courses=function(){var a=m.prop({});var d=m.prop([]);var c=m.prop("");var b=m.prop([]);return{associates:a,courses:d,error:c,excluded:b,getData:function(e){return m.request({method:"POST",url:"/lms/processfile",data:e,serialize:function(f){return f},extract:nonJsonErrors})},clearCourses:function(){a({});d([]);b([]);c("")}}};var LMSapp={controller:function(c){var a=m.prop(false);var b=m.prop("");var f=function(){c.error(l.errors.serverError())};var e=function(g){m.startComputation();try{var n=0;var h={};var r=[];for(var k=0;k<g.length;k=n+1){n=g.indexOf("\n",k);if(n==-1){n=g.length}var s=g.substring(k,n-1).split("\t");if(!(/\d+/.test(s[0]))){continue}if(!(s[0] in h)){h[s[0]]={name:s[1].split(", ").reverse(),completed:[],assigned:[]}}var q=s[5].replace(/(\s?-?\s?programmes? d\'Ã©tudes)|(\s?-?\s?curriculum)/i,"");var o="assigned";if(s[8]!=""){o="completed"}var j=r.indexOf(q);if(j>=0){h[s[0]][o].push(j)}else{r.push(q);h[s[0]][o].push(r.length-1)}}c.courses(r);c.associates(h)}catch(p){c.error(l.errors.fileParseError())}finally{m.endComputation()}};var d=document.getElementById("lmsdata");if(d){try{e(decodeURIComponent(atob(d.textContent)))}finally{d.parentNode.removeChild(d)}}return{associates:c.associates,courses:c.courses,excluded:c.excluded,error:c.error,printBackground:a,filterString:b,getCoursesFromServer:function(g){if(g.length>0){formdata=new FormData;formdata.append("csvfile",g[0]);c.error("");c.getData(formdata).then(function(h){c.associates(h.associates);c.courses(h.courses)},f)}},getCoursesLocal:function(h){if(h.length>0){c.clearCourses();var j=h[0];if(j.type!="text/plain"){c.error(l.errors.fileTypeError());return}var g=new FileReader();g.onload=function(k){e(g.result)};g.readAsText(j)}},clearCourses:function(){c.clearCourses();document.getElementById("opform").reset()},noSubmit:function(g){g.stopPropagation();g.preventDefault()},toggleExcluded:function(g){i=c.excluded().indexOf(g);if(i>=0){c.excluded().splice(i,1)}else{c.excluded().push(g)}},excludeAll:function(g){if(g){c.excluded(c.courses().map(function(j,h){return h}))}else{c.excluded([])}},removeFilter:function(){b("")},filterKeyUp:function(g){if(g.keyCode==27){b("")}else{b(g.target.value)}},nonCompletedCount:function(g){var j=g.length;for(var h=0;h<g.length;h++){if(c.excluded().indexOf(g[h])>=0){j--}}return j},printTable:function(){window.print()}}},interfaceView:function(c){var a=(c.courses().length<=0);var b=function(){if(a){return""}return[m("div.col-sm-8",[m("h4",[m("div",{className:"btn-group pull-right"},[m("button",{className:"btn btn-xs btn-primary",onclick:c.excludeAll.papp(false)},l.main.btnAll()),m("button",{className:"btn btn-xs btn-default",onclick:c.excludeAll.papp(true)},l.main.btnNone())]),l.main.step2()]),m("div.input-group.input-group-sm",[m("input.form-control",{placeholder:l.main.filterList(),value:c.filterString(),onkeyup:c.filterKeyUp}),m("span.input-group-btn",m("button",{className:"btn btn-default btn-danger",onclick:c.removeFilter},m("span.glyphicon.glyphicon-remove")))]),m("div",{className:"btn-group-vertical btn-block scrollable-btn-group"},c.courses().filter(function(d){return(d.toLowerCase().indexOf(c.filterString().toLowerCase())>-1)}).map(function(d){var e=c.courses().indexOf(d);return m("button",{className:"btn btn-xs "+(c.excluded().indexOf(e)>=0?"btn-default":"btn-primary"),onclick:c.toggleExcluded.papp(e)},d)}))]),m("div.col-sm-2",[m("h4",l.main.step3()),m("br"),m("label",[m("input.control-label",{type:"checkbox",checked:c.printBackground(),onclick:m.withAttr("checked",c.printBackground)}),l.main.printBackground()]),m("button",{className:"btn btn-default",onclick:c.printTable,style:"margin-top: 10px"},l.main.printButton())])]};return m("div",{className:"noprint"},m("div"+(a?".row":""),m("div"+(a?".col-sm-6.col-sm-offset-3.col-md-4.col-md-offset-4":""),[topBanner(a),m("div.jfdtron.row",[languageWidget(),m("div"+(a?".col-sm-8.col-sm-offset-2.text-center":".col-sm-2"),[m("h4",l.main.step1()),m("form#opform",{onsubmit:c.noSubmit},[m("div.btn-group-vertical",[m("span",{className:"btn btn-default btn-lg btn-file"},[m("span#browsecaption",l.main.browseFile()),m("input",{type:"file",onchange:m.withAttr("files",c.getCoursesLocal)})]),m("button",{className:"btn btn-default",onclick:c.clearCourses},l.main.clearTable())])])]),b()])])))},tableView:function(a){return[m("h2",l.main.tableTitle()),m("p",l.main.tableDesc()),m("table",{className:"table table-bordered table-condensed"},[m("thead",m("tr",[m("th",l.main.associate()),a.courses().filter(function(b,c){return(a.excluded().indexOf(c)<0)}).map(function(b){return m("th",b)})])),m("tbody",Object.keys(a.associates()).map(function(b){return m("tr",[m("th.row-header",[m("span",{className:"label label-success"},a.nonCompletedCount(a.associates()[b].assigned)),m("span",m.trust("&nbsp;")),m("a[href='/"+b+"']",{config:m.route},a.associates()[b].name[0]+" "+a.associates()[b].name[1][0]+".")]),a.courses().filter(function(c,d){return(a.excluded().indexOf(d)<0)}).map(function(c){var d=a.courses().indexOf(c);if(a.associates()[b].completed.indexOf(d)>=0){return m("td",{className:"val completed"+(a.printBackground()?"F":""),key:d})}else{if(a.associates()[b].assigned.indexOf(d)>=0){return m("td",{className:"val assigned"+(a.printBackground()?"F":""),key:d})}else{return m("td",{className:"val unassigned"+(a.printBackground()?"F":""),key:d})}}})])}))]),m("p",l.main.tableLegend())]},view:function(b){var a=[this.interfaceView(b)];if(b.courses().length>0){a.push(this.tableView(b))}else{if(b.error().length>0){a.push(errorAlert(b.error()))}}return a}};var LMSassociate={controller:function(b){var a=m.route.param("assoc");return{currentAssociate:a,courses:b.courses,associates:b.associates,excluded:b.excluded,returnHome:function(){m.route("/")},printList:function(){window.print()}}},interfaceView:function(a){return m("div",{className:"noprint"},[topBanner(),m("div.jfdtron.row",[languageWidget(),m("button",{className:"btn btn-default",onclick:a.returnHome},l.assoc.backButton()),m("button",{className:"btn btn-default",onclick:a.printList,style:"margin-left: 10px"},l.assoc.printButton())])])},associateView:function(b){var a=b.currentAssociate;if(a in b.associates()){return[m("h1",l.assoc.assocHeader()),m("h2",[b.associates()[a].name[0]+" "+b.associates()[a].name[1]+" ",m("em",a)]),m("ul",b.courses().filter(function(c,d){return((b.associates()[a].assigned.indexOf(d)>=0)&&(b.excluded().indexOf(d)<0))}).map(function(c){return m("li",c)})),m("hr"),m("p",l.assoc.assocMessage())]}else{return errorAlert(l.errors.assocNotFound())}},view:function(b){var a=[this.interfaceView(b)];if(b.courses().length>0){a.push(this.associateView(b))}else{a.push(errorAlert(l.errors.assocNoData()))}return a}};var LMShelp={controller:function(){return{returnHome:function(){m.route("/")}}},view:function(a){return m("div.as-table",[m("div",{className:"noprint"},[topBanner(),m("div.jfdtron.row",[languageWidget(),m("button",{className:"btn btn-default",onclick:a.returnHome},l.assoc.backButton())])]),m("div.as-table-row",m("iframe",{src:"help/"+l.currentLanguage()+"/index.html"}))])}};